// This will handle the file upload and prediction logic
document
  .getElementById("file-upload-form")
  .addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent form from submitting the traditional way (page reload)

    // Display the loading state (disable the submit button to prevent multiple clicks)
    const submitButton = document.querySelector('button[type="submit"]');
    submitButton.innerHTML = "Predicting..."; // Change button text
    submitButton.disabled = true; // Disable the button

    // Hide the prediction result section initially
    document.getElementById("prediction-result").style.display = "none";

    // Create a new FormData object which will contain the file data
    const formData = new FormData(this);

    // Perform an AJAX POST request to send the file to the server
    fetch("/predict", {
      method: "POST",
      body: formData,
    })
      .then((response) => response.json()) // Expecting JSON response from the server
      .then((data) => {
        // Handle the prediction result
        if (data.prediction) {
          // Show the prediction result
          const resultText =
            data.prediction === "malicious" ? "Malicious" : "Legitimate";
          document.getElementById(
            "result-text"
          ).innerText = `The file is classified as: ${resultText}`;
          document.getElementById("prediction-result").style.display = "block";
        } else {
          // If there's an issue (e.g., missing prediction), display an error message
          document.getElementById("result-text").innerText =
            "Error: Unable to classify the file.";
          document.getElementById("prediction-result").style.display = "block";
        }

        // Reset the submit button state after the result is displayed
        submitButton.innerHTML = "Predict"; // Reset button text
        submitButton.disabled = false; // Enable the button again
      })
      .catch((error) => {
        console.error("Error:", error); // Log the error
        // Show error message if the request fails
        alert("There was an error processing your request.");
        submitButton.innerHTML = "Predict"; // Reset button text
        submitButton.disabled = false; // Enable the button again
      });
  });
